### 결제 생성하기

결제 생성 요청에 대해 좀 더 자세히 알아봅니다. 아래 예제는 결제 생성 API 가 지원하는 모든 파라미터를 사용한 코드입니다.

```curl
curl https://toss.im/tosspay/api/v1/payments \
-H "content-Type: application/json" \
-d '{
"orderNo":"1",                                           # 토스몰 고유의 주문번호 (필수)
"amount":35000,                                          # 결제 금액 (필수)
"productDesc":"토스티셔츠",                                 # 상품 정보 (필수)
"apiKey":"sk_test_apikey1234567890a",                    # 상점의 API Key (필수)
"retUrl":"http://YOUR-SITE.COM/ORDER-CHECK?orderno=1",   # 결제 완료 후 연결할 웹페이지 URL
"amountTaxable":22727,                                   # 결제 금액 중 과세금액
"amountTaxFree":10000,                                   # 결제 금액 중 비과세금액
"amountVat":2273,                                        # 결제 금액 중 부가세
"amountServiceFee":0,                                    # 결제 금액 중 봉사료
"expiredTime":"2015-12-01 12:47:35",                     # 결제 만료 예정 시각
"escrow":false,                                          # 에스크로 여부
"cashReceipt":true,                                      # 현금영수증 발급 가능 여부
"autoExecute":false,                                      # 자동 승인 여부
"metadata":"{'size':'XL','color':'Red'}"                 # metadata 값
}'
```

#### 결제 생성 API 의 Endpoint

POST https://toss.im/tosspay/api/v1/payments

#### 필수 Parameters

결제 생성 요청 시 반드시 아래 4 가지 값을 함께 보내주셔야합니다.

1. **상점 주문번호** : 추후 상점 주문 정보와 결제 정보를 매칭하기 위해 필요
2. **결제 금액** : 손님으로부터 받을 금액
3. **상품 정보** : 결제할 상품에 대한 정보 (상품명)
4. **상점 API Key** : 이곳에 '테스트용 Key'를 넣으면 테스트 결제가, '실거래용 Key'를 넣으면 진짜 출금되는 결제가 생성됩니다.
5. **구매자 승인 완료 후 연결할 URL** : 구매자가 결제를 승인하면 이 파라미터를 통해 등록한 URL 로 구매자를 보내드립니다. 일반적으로 구매 완료 페이지 또는 구매 완료 페이지로 연결할 수 있는 곳을 지정합니다.

#### 결제 만료 기한 (expiredTime)

이 파라미터를 통해 '결제 생성 후, 언제까지 결제 승인을 진행할 수 있는지' 설정할 수 있습니다. '결제 대기' 상태인 결제건의 만료 기한이 도래하면 자동으로 결제가 취소됩니다.

상점 혹은 판매 물품에 특성에 따라 결제 만료 기간을 길게 혹은 짧게 설정할 수 있습니다.

* 재고의 변동이 적고, 구매자의 결제가 급하지 않다면 결제 만료 기한을 길게 설정하세요. 구매자는 먼저 주문만 해두고 원하는 시점에 결제할 수 있습니다. (예를 들어, 주문은 오전에 하고 밤에 Toss 앱을 설치하여 결제를 완료할 수 있습니다)
* 재고의 변동이 크거나 '결제 대기' 상태를 오래 지속하고싶지 않은 경우엔 결제 만료 기한을 짧게 설정하세요.

결제 만료 기한은 최소 10 분, 최대 24 시간이며, 따로 설정하지 않는 경우 1 시간으로 설정됩니다.

#### 에스크로 여부 (escrow)

에스크로 결제로 진행할지 설정할 수 있습니다.

* **true** : 에스크로 결제를 생성합니다.
* **false** : 일반 결제를 생성합니다. (값을 설정하지 않으면 false)

에스크로 결제는 일종의 '구매자 보호 정책'입니다. 온라인 상에서 실물거래를 하는 경우, 구매자가 판매자에게 입금은 하였으나 물품을 받지 못하거나 원치 않는 물품을 받았을 경우 금전적 손실이 발생할 수 있는데, 이를 방지하기 위한 것입니다.

결제가 완료되면 결제 금액만큼 구매자의 계좌에서 출금되지만, 구매자가 물품을 정상적으로 받았다고 확정(구매확정)하기 전까지는 정산되지 않습니다. 따라서 구매자는 좀 더 안심하고 물품을 구매할 수 있습니다.

온라인상에서 실물을 판매하는 경우, 구매자에게 '에스크로 결제'를 선택할 수 있는 권한을 필수적으로 제공해야합니다.

에스크로 결제 생성 및 승인 완료 후, 반드시 '진행' 처리를 해주어야 합니다. ['에스크로 결제 진행'](http://tossdev.github.io/gettingstarted.html#escrow) 문서를 꼭 확인하세요.

#### 현금영수증 발급 가능 여부 (cashReceipt)

현금영수증 발급 가능 여부를 설정할 수 있습니다.
(참고 : 문화상품권이나 백화점상품권, 모바일 쿠폰 등 과세 대상에서 제외되는 유가증권 등의 상품은 현금영수증 발행 대상에서 제외됩니다)

* **true** : 현금영수증 발급 가능 (값을 설정하지 않으면 true)
* **false** : 현금영수증 발급 불가

#### 자동 승인 여부 (autoExecute)

구매자의 인증이 완료되면 바로 결제 완료 처리할지, 최종적으로 가맹점의 승인을 거칠지 설정할 수 있습니다.

* **true** : 구매자 인증 완료 시 바로 결제 완료 처리합니다.
* **false** : 구매자 인증 완료 후 가맹점의 최종 승인 시 결제 완료 처리합니다.

재고 상황이 빠르게 변하는 경우나 서비스 흐름 상 결제의 최종 승인은 가맹점이 해야하는 경우, 자동 승인을 false 로 설정함으로써 대응할 수 있습니다.

#### 결제 연관 data 기록 (metadata)

생성하는 결제 건과 연관된 추가적인 데이터가 있다면 이 파라미터를 활용하여 저장해둘 수 있습니다. (결제가 완료될 때 보내드리는 callback 에 여기에 저장해준 데이터를 함께 보내드립니다)

#### 복합과세 처리 (amount-)

전체 결제 금액 중 '비과세' 처리해야할 금액이 섞여있거나 부가세, 봉사료 비중을 원하는대로 설정하고 싶다면 결제 생성 시 '복합과세' 파라미터를 이용하세요.

* **amountTaxable** : 결제 금액 중 '과세금액' 비중
* **amountTaxFree** : 결제 금액 중 '비과세금액' 비중
* **amountVat** : 결제 금액 중 '부가세' 비중
* **amountServiceFee** : 결제 금액 중 '봉사료' 비중

위 네 가지 값 중 하나라도 0 이 아닌 값으로 설정하면 해당 결제 건은 '복합과세' 결제로 처리되며, 네 가지 값의 합은 총 결제 금액(amount)과 반드시 동일해야합니다. (동일하지 않을 시 에러 발생)
위 파라미터를 통해 설정한 값은 현금 영수증 발행 시 그대로 반영됩니다.

위 파라미터 값을 설정하지 않는 경우, 자동으로 아래와 같이 처리됩니다.

* **부가세** : 전체 금액(amount)을 11 로 나눈 후 소수점 첫째 자리에서 올림
* **과세금액** : 전체 금액에서 부가세를 뺀 나머지 값
* **비과세금액, 봉사료** : 0

단, 현금영수증 발행 불가 결제(cashReceipt = false)인 경우, 아래와 같이 처리됩니다.

* **과세금액** : 전체 금액(amount)과 동일
* **부가세, 비과세금액, 봉사료** : 0
